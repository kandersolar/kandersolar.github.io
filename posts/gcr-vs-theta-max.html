
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Single-axis tracking: GCR vs max angle &#8212; the kevbase</title>
    
    <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
  
    
    <link rel="stylesheet"
      href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
    <link rel="preload" as="font" type="font/woff2" crossorigin
      href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">
  
    
      
  
    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/pydata-sphinx-theme.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.min.css" />
    
    <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">
  
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
     
<link
  rel="alternate"
  type="application/atom+xml"
  href="../blog/atom.xml"
  title="kevbase"
/>
 
<style type="text/css">
  ul.ablog-archive {
    list-style: none;
    overflow: auto;
    margin-left: 0px;
  }
  ul.ablog-archive li {
    float: left;
    margin-right: 5px;
    font-size: 80%;
  }
  ul.postlist a {
    font-style: italic;
  }
  ul.postlist-style-disc {
    list-style-type: disc;
  }
  ul.postlist-style-none {
    list-style-type: none;
  }
  ul.postlist-style-circle {
    list-style-type: circle;
  }
</style>

  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/favicon.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../index.html">
  About
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../publications.html">
  Publications
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../blog.html">
  Blog
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../report.html">
  Climate Report
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this site..." aria-label="Search this site..." autocomplete="off" >
</form>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar">
              <div class="sidebar-start-items">  
<h2>
   <i class="fa fa-calendar"></i>
  2021-09-30 
</h2>

<ul>
       
<li id="tags">
  <span
    ><i class="fa-fw fa fa-tags"></i> </span
  >
   
  <a href="../blog/tag/photovoltaics.html">photovoltaics</a>   
  <a href="../blog/tag/python.html">python</a>  
</li>
 
</ul>

<h3>
  <a href="../blog.html">Recent Posts</a>
</h3>
<ul>
   
  <li>
    <a href="psm3-pixels-boundaries.html"
      >04 September - PSM3 Pixel Boundaries</a
    >
  </li>
  
  <li>
    <a href="opengl-compute-shaders-spa-benchmarks.html"
      >21 August - OpenGL Compute Shaders: SPA</a
    >
  </li>
  
  <li>
    <a href="opengl-compute-shaders-builtin-accuracy.html"
      >13 August - OpenGL Compute Shaders: Accuracy of Math Functions</a
    >
  </li>
  
  <li>
    <a href="opengl-compute-shaders-first-steps.html"
      >30 July - OpenGL Compute Shaders: First Steps</a
    >
  </li>
  
  <li>
    <a href="linalg-sparse-solve.html"
      >09 April - Speeding up pvfactors</a
    >
  </li>
  
</ul>

<h3>
  <a href="../blog/archive.html">Archives</a>
</h3>
<ul>
   
  <li>
    <a href="../blog/2022.html">2022 (5)</a>
  </li>
    
  <li>
    <a href="../blog/2021.html">2021 (10)</a>
  </li>
    
  <li>
    <a href="../blog/2020.html">2020 (3)</a>
  </li>
   
</ul>

              </div>
              <div class="sidebar-end-items">
              </div>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                

<nav id="bd-toc-nav">
    
</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                 <section class="tex2jax_ignore mathjax_ignore" id="single-axis-tracking-gcr-vs-max-angle">
<h1>Single-axis tracking: GCR vs max angle<a class="headerlink" href="#single-axis-tracking-gcr-vs-max-angle" title="Permalink to this heading">¶</a></h1>
<p>Single-axis tracker rotation angles are commonly limited by the hardware’s maximum allowed rotation (45 and 60 degrees are common limits).  For arrays with backtracking activated, the time spent at max angle depends on GCR: the higher the GCR, the more the array backtracks, and the less time it spends at max angle.  So at some sufficiently large GCR the array will just touch max angle for an instant before it starts backtracking.  I don’t have a situation in mind for when this might be useful, but it seemed like a fun math problem to determine that boundary GCR.</p>
<p>The approach here is focused on the point on the tracking curve when backtracking is about to begin, as that represents the maximum realized angle of the tracker.  We start with Equation 14 from NREL Technical Report 76626 (<a class="reference external" href="https://www.nrel.gov/docs/fy20osti/76626.pdf">PDF</a>):</p>
<div class="math notranslate nohighlight">
\[
\theta_c = - \mathrm{sign}(\theta_T) \cos^{-1}\left(\frac{|\cos(\theta_T - \beta_c)|}{\mathrm{GCR} \cos\beta_c} \right)
\]</div>
<p>For simplicity let’s assume <span class="math notranslate nohighlight">\(\beta_c=0\)</span> (otherwise the maximum realized angle is asymmetrical across solar noon). At the transition from true-tracking to backtracking we have <span class="math notranslate nohighlight">\(\theta_c = 0\)</span> and <span class="math notranslate nohighlight">\(\theta_T=\theta_\max\)</span>, leading to this relation:</p>
<div class="math notranslate nohighlight">
\[
\mathrm{GCR} = \cos \theta_\max
\]</div>
<p>Surprisingly simple!  Tracker geometry is so fun.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pvlib</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="n">loc</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">Location</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="o">-</span><span class="mi">80</span><span class="p">)</span>
<span class="n">times</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2019-06-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2019-06-02&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;1min&#39;</span><span class="p">,</span> <span class="n">tz</span><span class="o">=</span><span class="s1">&#39;Etc/GMT+5&#39;</span><span class="p">)</span>
<span class="n">solpos</span> <span class="o">=</span> <span class="n">loc</span><span class="o">.</span><span class="n">get_solarposition</span><span class="p">(</span><span class="n">times</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_sat</span><span class="p">(</span><span class="n">gcr</span><span class="p">,</span> <span class="n">max_angle</span><span class="p">):</span>
    <span class="n">tracker</span> <span class="o">=</span> <span class="n">pvlib</span><span class="o">.</span><span class="n">tracking</span><span class="o">.</span><span class="n">singleaxis</span><span class="p">(</span><span class="n">solpos</span><span class="o">.</span><span class="n">apparent_zenith</span><span class="p">,</span>
                                        <span class="n">solpos</span><span class="o">.</span><span class="n">azimuth</span><span class="p">,</span> 
                                        <span class="n">axis_tilt</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                        <span class="n">axis_azimuth</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span>
                                        <span class="n">max_angle</span><span class="o">=</span><span class="n">max_angle</span><span class="p">,</span>
                                        <span class="n">backtrack</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                        <span class="n">gcr</span><span class="o">=</span><span class="n">gcr</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tracker</span><span class="p">[</span><span class="s1">&#39;tracker_theta&#39;</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>

<span class="k">for</span> <span class="n">gcr</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]:</span>
    <span class="n">max_angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">gcr</span><span class="p">))</span>
    <span class="n">theta</span> <span class="o">=</span> <span class="n">get_sat</span><span class="p">(</span><span class="n">gcr</span><span class="p">,</span> <span class="n">max_angle</span><span class="p">)</span>
    <span class="n">theta</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;gcr=</span><span class="si">{</span><span class="n">gcr</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">max_angle</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">times</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax1</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x1c95771cd48&gt;
</pre></div>
</div>
<img alt="../_images/863da4e53fdcbb7759ff8879f899f8c604f273947cf81fed8911698b5add18ba.png" src="../_images/863da4e53fdcbb7759ff8879f899f8c604f273947cf81fed8911698b5add18ba.png" />
</div>
</div>
<p>Let’s do a slightly more rigorous validation using scipy to find the appropriate GCR for a given max angle numerically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">scipy</span>
<span class="k">def</span> <span class="nf">find_gcr</span><span class="p">(</span><span class="n">max_angle</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">objective</span><span class="p">(</span><span class="n">gcr</span><span class="p">):</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">get_sat</span><span class="p">(</span><span class="n">gcr</span><span class="p">,</span> <span class="n">max_angle</span><span class="p">)</span>
        <span class="c1"># optimize for two things:</span>
        <span class="c1">#  1) tiny difference between max observed angle and max allowed angle</span>
        <span class="c1">#  2) no time actually spent at max allowed angle</span>
        <span class="c1"># it&#39;s a little gross having a non-smooth error function like this, but it works ok here</span>
        <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">theta</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">max_angle</span><span class="p">)</span> <span class="o">+</span> <span class="p">((</span><span class="n">theta</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">-</span> <span class="n">max_angle</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">xopt</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">fminbound</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xopt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">max_angles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">gcrs</span> <span class="o">=</span> <span class="p">[</span><span class="n">find_gcr</span><span class="p">(</span><span class="n">ang</span><span class="p">)</span> <span class="k">for</span> <span class="n">ang</span> <span class="ow">in</span> <span class="n">max_angles</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">max_angles</span><span class="p">,</span> <span class="n">gcrs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;scipy&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">max_angles</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">max_angles</span><span class="p">)),</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;theory&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;tab:orange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Max Angle [degrees]&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;GCR&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;GCR&#39;)
</pre></div>
</div>
<img alt="../_images/3a14c3e75f2f8b99b92a9fcd98a76b2e0a695a49fc707406fb2adf7ef96d883e.png" src="../_images/3a14c3e75f2f8b99b92a9fcd98a76b2e0a695a49fc707406fb2adf7ef96d883e.png" />
</div>
</div>
</section>

<div class="section">
    

<div class="section">
  <span style="float: left">
     
    <a href="seasonal-tilt-optimization.html">
      <i class="fa fa-arrow-circle-left"></i> Seasonal tilt optimization
    </a>
    
  </span>
  <span>&nbsp;</span>
  <span style="float: right">
     
    <a href="led-iv-curves.html">
      LED I-V Curves <i
        class="fa fa-arrow-circle-right"
      ></i
      >
    </a>
    
  </span>
</div>
  
</div>

              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
              
          </main>
          

      </div>
    </div>
  
    <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>
  <footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2015-2024, Kevin Anderson.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 5.3.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>